pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

poke(0x5F2D, 1) -- Mouse

function _init()

	mouse = {}
	update_mouse()

	loop = {
		x = 0,
		y = 0,
		r = 7,
		w = 3,
	}
	curios = {}
	speed = 0.2

	camera(-64, -64)
end

function _update()
	update_mouse()

	if (btn(0)) then loop.x = loop.x - 1 end
	if (btn(1)) then loop.x = loop.x + 1 end
	if (btn(2)) then loop.y = loop.y - 1 end
	if (btn(3)) then loop.y = loop.y + 1 end
	if (btn(4)) then loop.r = loop.r - 1 end
	if (btn(5)) then loop.r = loop.r + 1 end

	loop.r = clamp(loop.r, loop.w, 32)
	loop.x = clamp(loop.x, loop.r - 64, 64 - loop.r - 1)
	loop.y = clamp(loop.y, loop.r - 64, 64 - loop.r - 1)

	local i = 1
	while i <= #curios do
		curios[i].z = curios[i].z - speed
		if curios[i].z < 1 then
			deli(curios, i)
		else
			i = i + 1
		end
	end

	if (t() % 2) == 0 then
		local r = rnd(64)
		add_curio(rnd(128 - 2 * r) - 64 + r, rnd(128 - 2 * r) - 64 + r, r, 0)
	end
end

function _draw()
	cls(0)
	for _, curio in ipairs(curios) do
		if curio.z >= 1 then
			sspr(0, 0, 16, 16, (curio.x - 8) / curio.z, (curio.y - 8) / curio.z, 2 * curio.r / curio.z, 2 * curio.r / curio.z, curio.flip_x, curio.flip_y)
		end
	end
	for w=0,loop.w-1 do
		circ(loop.x, loop.y, loop.r - w, 10)
	end

	pset(mouse.x - 1, mouse.y, 7)
	pset(mouse.x + 1, mouse.y, 7)
	pset(mouse.x, mouse.y - 1, 7)
	pset(mouse.x, mouse.y + 1, 7)
end

function clamp(x, min_x, max_x)
	x = max(x, min_x)
	x = min(x, max_x)
	return x
end

function add_curio(x, y, r, id)
	add(curios, {
		x = x,
		y = y,
		z = 128,
		r = r,
		id = id,
		flip_x = rnd(1) < 0.5,
		flip_y = rnd(1) < 0.5,
	}, 1)
end

function update_mouse()
		mouse.x = stat(32) - 64
		mouse.y = stat(33) - 64
		mouse.x = clamp(mouse.x, -64, 63)
		mouse.y = clamp(mouse.y, -64, 63)
end

__gfx__
00000000650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000006655560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066666655560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666666555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666566555555660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06565556655555560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06555566655655550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65555666555665500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55556666555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65556555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66555555555556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06555555665556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555565566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555666556660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00656600066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
